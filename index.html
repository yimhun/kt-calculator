import React, { useState, useEffect } from 'react';

// SVG 아이콘
const X = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>);
const FileText = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>);
const Wifi = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 20h.01"/><path d="M2 8.82a15 15 0 0 1 20 0"/><path d="M5 12.859a10 10 0 0 1 14 0"/><path d="M8.5 16.429a5 5 0 0 1 7 0"/></svg>);
const Tv = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="20" height="15" x="2" y="7" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>);
const Phone = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>);
const Calculator = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>);
const Camera = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>);
const Wrench = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>);
const Check = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 6 9 17l-5-5"/></svg>);

export default function KTInternetCalculator() {
  const [selectedProducts, setSelectedProducts] = useState({ internet: true, wifi: false, tv: false, phone: false, cctv: false, hiorder: false });
  const [internetPlan, setInternetPlan] = useState('');
  const [tvPlan, setTvPlan] = useState('');
  const [settopBox, setSettopBox] = useState('');
  const [phonePlan, setPhonePlan] = useState('');
  const [cctvCount, setCctvCount] = useState('');
  const [installationType, setInstallationType] = useState('weekday');
  const [uratDiscount, setUratDiscount] = useState(false);
  const [showResult, setShowResult] = useState(false);
  const [totalPrice, setTotalPrice] = useState(0);
  const [discountAmount, setDiscountAmount] = useState(0);
  const [installationFee, setInstallationFee] = useState(0);
  const [installationBreakdown, setInstallationBreakdown] = useState({});
  const [breakdown, setBreakdown] = useState({});

  const internetPlans = {
    '슬림': { name: '인터넷 슬림 (100M)', standalone: 22000, withTV: 22000, family: 16500, wifiPrice: 1100 },
    '베이직': { name: '인터넷 베이직 (500M)', standalone: 33000, withTV: 27500, family: 22000, wifiPrice: 1100 },
    '에센스': { name: '인터넷 에센스 (1G)', standalone: 38500, withTV: 33000, family: 27500, wifiPrice: 0 }
  };

  const tvPlans = {
    '베이직': { name: 'TV 베이직 (236채널)', internetCombined: 12100 },
    '라이트': { name: 'TV 라이트 (240채널)', internetCombined: 13200 },
    '에센스': { name: 'TV 에센스 (266채널)', internetCombined: 16500 },
    '모든G': { name: 'TV 모든G (256채널)', internetCombined: 17600 },
    '디즈니+모든G': { name: 'TV 디즈니+ 모든G (256채널)', internetCombined: 21500 }
  };

  const settopBoxes = {
    '기가지니A': { name: '기가지니A', price: 3300 },
    '기가지니3': { name: '기가지니3', price: 4400 },
    '셋탑박스4': { name: '셋탑박스4 (8K)', price: 6600 },
    '사운드바': { name: '올인원 사운드바', price: 8800 }
  };

  const phonePlans = {
    '유선3000': { name: '유선 3000', withInternet: 6050, withInternetTV: 6050 },
    '유무선3000': { name: '유무선 3000', withInternet: 8250, withInternetTV: 8250 },
    'AI전화': { name: 'AI 전화', withInternet: 9900, withInternetTV: 9900 },
    '우리끼리3000': { name: '우리끼리 3000 (인터넷전화)', withInternet: 6294, withInternetTV: 6294 }
  };

  const cctvPlans = {
    '1': { name: 'i-view 1대', price: 13200 },
    '2': { name: 'i-view 2대', price: 24200 },
    '3': { name: 'i-view 3대', price: 35200 },
    '4': { name: 'i-view 4대', price: 46200 }
  };

  // 으랏차차 결합할인 테이블 (슬림 포함)
  const uratPhoneDiscount = {
    '에센스': { '유선3000': -4620, '유무선3000': -5500, 'AI전화': -2750, '우리끼리3000': -3740 },
    '베이직': { '유선3000': -4620, '유무선3000': -5500, 'AI전화': -2750, '우리끼리3000': -3740 },
    '슬림': { '유선3000': -2420, '유무선3000': -3300, 'AI전화': -550, '우리끼리3000': -1540 }
  };

  const uratTVDiscount = {
    '에센스': { '베이직': -8140, '라이트': -8140, '에센스': -9240, '모든G': -9240, '디즈니+모든G': -9240 },
    '베이직': { '베이직': -8140, '라이트': -8140, '에센스': -9240, '모든G': -9240, '디즈니+모든G': -9240 },
    '슬림': { '베이직': -2640, '라이트': -2640, '에센스': -3740, '모든G': -3740, '디즈니+모든G': -3740 }
  };

  // 인터넷+전화+TV 결합 시 전화 할인 (슬림 기준)
  const uratPhoneDiscountForTriple = { '유선3000': -2420, '유무선3000': -3300, 'AI전화': -550, '우리끼리3000': -1540 };

  const toggleProduct = (product) => {
    setSelectedProducts(prev => ({ ...prev, [product]: !prev[product] }));
    if (selectedProducts[product]) {
      if (product === 'tv') { setTvPlan(''); setSettopBox(''); }
      if (product === 'phone') setPhonePlan('');
      if (product === 'cctv') setCctvCount('');
    }
  };

  const getInternetPrice = () => {
    if (!internetPlan) return 0;
    const internet = internetPlans[internetPlan];
    const hasTV = selectedProducts.tv && tvPlan;
    const hasPhone = selectedProducts.phone && phonePlan;
    let price = (hasTV && hasPhone) ? internet.family : hasTV ? internet.withTV : internet.standalone;
    if (selectedProducts.wifi) price += internet.wifiPrice;
    return price;
  };

  const getTVPrice = () => (!selectedProducts.tv || !tvPlan) ? 0 : tvPlans[tvPlan].internetCombined;
  const getSettopBoxPrice = () => (!selectedProducts.tv || !settopBox) ? 0 : settopBoxes[settopBox].price;
  const getPhonePrice = () => {
    if (!selectedProducts.phone || !phonePlan) return 0;
    const hasTV = selectedProducts.tv && tvPlan;
    return hasTV ? phonePlans[phonePlan].withInternetTV : phonePlans[phonePlan].withInternet;
  };
  const getCCTVPrice = () => (!selectedProducts.cctv || !cctvCount) ? 0 : cctvPlans[cctvCount].price;

  // 으랏차차 결합할인 계산 (슬림 포함)
  const getUratDiscountAmount = () => {
    if (!uratDiscount || !internetPlan) return 0;
    let discount = 0;
    const hasTV = selectedProducts.tv && tvPlan;
    const hasPhone = selectedProducts.phone && phonePlan;

    if (hasTV && hasPhone) {
      if (uratTVDiscount[internetPlan] && uratTVDiscount[internetPlan][tvPlan]) {
        discount += uratTVDiscount[internetPlan][tvPlan];
      }
      if (uratPhoneDiscountForTriple[phonePlan]) {
        discount += uratPhoneDiscountForTriple[phonePlan];
      }
    } else if (hasTV) {
      if (uratTVDiscount[internetPlan] && uratTVDiscount[internetPlan][tvPlan]) {
        discount += uratTVDiscount[internetPlan][tvPlan];
      }
    } else if (hasPhone) {
      if (uratPhoneDiscount[internetPlan] && uratPhoneDiscount[internetPlan][phonePlan]) {
        discount += uratPhoneDiscount[internetPlan][phonePlan];
      }
    }
    return discount;
  };

  // 하이오더 결합할인 계산 (슬림 제외, TV 결합 시 불가)
  const getHiorderDiscountAmount = () => {
    if (!selectedProducts.hiorder || !internetPlan) return 0;
    if (internetPlan === '슬림') return 0;
    const hasTV = selectedProducts.tv && tvPlan;
    if (hasTV) return 0;
    if (internetPlan === '에센스' || internetPlan === '베이직') return -5500;
    return 0;
  };

  const calculateInstallationFee = () => {
    if (!internetPlan) return { total: 0, breakdown: {} };
    const isWeekend = installationType === 'weekend';
    let fee = 0;
    const installBreakdown = {};
    const hasTV = selectedProducts.tv && tvPlan;
    const hasPhone = selectedProducts.phone && phonePlan;
    
    if (hasTV) {
      fee = isWeekend ? 71250 : 56200;
      installBreakdown.internetTV = { name: '인터넷 + TV 동시 설치', price: fee };
    } else {
      fee = isWeekend ? 45000 : 36000;
      installBreakdown.internet = { name: '인터넷 설치', price: fee };
    }
    
    if (selectedProducts.wifi) installBreakdown.wifi = { name: '와이파이 설치', price: 0, note: '동시 설치 시 면제' };
    
    if (hasPhone) {
      const phoneFee = phonePlan === '우리끼리3000' ? (isWeekend ? 45000 : 24000) : (isWeekend ? 45000 : 32000);
      fee += phoneFee;
      installBreakdown.phone = { name: phonePlan === '우리끼리3000' ? '인터넷전화 설치' : '일반전화 설치', price: phoneFee };
    }
    
    return { total: fee, breakdown: installBreakdown };
  };

  const calculatePrice = () => {
    const internetPrice = getInternetPrice();
    const tvPrice = getTVPrice();
    const settopPrice = getSettopBoxPrice();
    const phonePrice = getPhonePrice();
    const cctvPrice = getCCTVPrice();
    const uratDisc = getUratDiscountAmount();
    const hiorderDisc = getHiorderDiscountAmount();
    const totalDiscount = uratDisc + hiorderDisc;
    const total = internetPrice + tvPrice + settopPrice + phonePrice + cctvPrice + totalDiscount;
    const installationResult = calculateInstallationFee();
    
    setTotalPrice(total);
    setDiscountAmount(totalDiscount);
    setInstallationFee(installationResult.total);
    setInstallationBreakdown(installationResult.breakdown);
    setBreakdown({ internet: internetPrice, tv: tvPrice, settop: settopPrice, phone: phonePrice, cctv: cctvPrice, uratDiscount: uratDisc, hiorderDiscount: hiorderDisc });
    setShowResult(true);
  };

  const resetCalculator = () => {
    setSelectedProducts({ internet: true, wifi: false, tv: false, phone: false, cctv: false, hiorder: false });
    setInternetPlan(''); setTvPlan(''); setSettopBox(''); setPhonePlan(''); setCctvCount('');
    setInstallationType('weekday'); setUratDiscount(false);
    setShowResult(false); setTotalPrice(0); setDiscountAmount(0);
    setInstallationFee(0); setInstallationBreakdown({}); setBreakdown({});
  };

  useEffect(() => { if (showResult) setShowResult(false); }, [internetPlan, tvPlan, settopBox, phonePlan, cctvCount, installationType, selectedProducts, uratDiscount]);

  const getDiscountLabel = () => {
    const hasTV = selectedProducts.tv && tvPlan;
    const hasPhone = selectedProducts.phone && phonePlan;
    if (hasTV && hasPhone) return '패밀리 할인';
    if (hasTV) return 'TV 결합 할인';
    return '';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-red-50 to-orange-50 py-8 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-3xl shadow-2xl overflow-hidden">
          <div className="bg-gradient-to-r from-red-600 to-red-500 text-white p-8">
            <div className="flex items-center justify-center gap-3 mb-3">
              <Calculator className="w-10 h-10" />
              <h1 className="text-3xl md:text-4xl font-bold">KT인터넷 요금 계산기 by NEO</h1>
            </div>
            <p className="text-center text-red-100 text-lg">원하시는 상품을 선택하고 월 이용요금을 확인하세요</p>
          </div>

          <div className="p-6 md:p-8">
            <div className="flex gap-3 mb-6">
              <button className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg flex items-center justify-center gap-2 text-sm md:text-base">
                <FileText className="w-4 h-4" /> 인터넷·전화 요금표
              </button>
              <button className="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-purple-600 hover:to-purple-700 transition-all shadow-lg flex items-center justify-center gap-2 text-sm md:text-base">
                <FileText className="w-4 h-4" /> TV 요금표
              </button>
            </div>

            <div className="bg-gray-50 rounded-2xl p-5 mb-6">
              <h2 className="text-base font-bold text-gray-800 mb-3">가입할 상품을 선택하세요</h2>
              <div className="flex flex-wrap gap-2">
                <button className="px-4 py-2 rounded-lg font-semibold text-white bg-red-600 cursor-default flex items-center gap-1 text-sm">
                  <Check className="w-3 h-3" /> 인터넷
                </button>
                {['wifi', 'tv', 'phone', 'cctv', 'hiorder'].map(p => (
                  <button key={p} onClick={() => toggleProduct(p)} className={`px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-1 text-sm ${selectedProducts[p] ? 'bg-red-600 text-white' : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-red-400'}`}>
                    {selectedProducts[p] && <Check className="w-3 h-3" />}
                    {p === 'wifi' ? '와이파이' : p === 'tv' ? 'TV' : p === 'phone' ? '전화' : p === 'cctv' ? 'CCTV' : '하이오더'}
                  </button>
                ))}
                <button onClick={() => setUratDiscount(!uratDiscount)} className={`px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-1 text-sm ${uratDiscount ? 'bg-blue-600 text-white' : 'bg-white text-blue-600 border-2 border-blue-400 hover:bg-blue-50'}`}>
                  {uratDiscount && <Check className="w-3 h-3" />} 으랏차차패키지
                </button>
              </div>
              {(uratDiscount || selectedProducts.hiorder) && (
                <div className="mt-3 text-xs text-blue-600 bg-blue-50 rounded-lg p-2">
                  {uratDiscount && <p>✓ 으랏차차 패키지: 인터넷+전화 또는 인터넷+TV 결합 시 추가 할인</p>}
                  {selectedProducts.hiorder && <p>✓ 하이오더 결합: 인터넷(베이직/에센스) + 하이오더 5대 이상 시 5,500원 할인 (슬림/TV결합 제외)</p>}
                </div>
              )}
            </div>

            <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
              <div className="bg-gray-100 p-3 flex items-center gap-2">
                <Wifi className="w-5 h-5 text-red-600" />
                <span className="font-bold text-gray-800 text-sm">인터넷 요금제 선택 <span className="text-red-600">*</span></span>
              </div>
              <div className="p-3 grid grid-cols-1 md:grid-cols-3 gap-2">
                {Object.entries(internetPlans).map(([key, plan]) => {
                  const hasTV = selectedProducts.tv && tvPlan;
                  const hasPhone = selectedProducts.phone && phonePlan;
                  let price = (hasTV && hasPhone) ? plan.family : hasTV ? plan.withTV : plan.standalone;
                  return (
                    <label key={key} className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: internetPlan === key ? '#dc2626' : '#e5e7eb', backgroundColor: internetPlan === key ? '#fef2f2' : 'white' }}>
                      <input type="radio" name="internet" value={key} checked={internetPlan === key} onChange={(e) => setInternetPlan(e.target.value)} className="w-4 h-4 text-red-600" />
                      <span className="ml-2 flex-1">
                        <span className="block font-semibold text-gray-800 text-xs">{plan.name}</span>
                        <span className="block text-red-600 font-bold text-sm">{price.toLocaleString()}원</span>
                      </span>
                    </label>
                  );
                })}
              </div>
              {internetPlan && getDiscountLabel() && <div className="px-3 pb-3"><span className="text-xs text-green-600 font-medium">✓ {getDiscountLabel()} 적용</span></div>}
            </div>

            {selectedProducts.wifi && internetPlan && (
              <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
                <div className="bg-gray-100 p-3 flex items-center gap-2">
                  <Wifi className="w-5 h-5 text-red-600" />
                  <span className="font-bold text-gray-800 text-sm">와이파이</span>
                </div>
                <div className="p-3">
                  <div className="flex items-center justify-between p-3 bg-red-50 rounded-lg border-2 border-red-200">
                    <span className="font-semibold text-gray-800 text-sm">기가 와이파이 홈 ax</span>
                    {internetPlans[internetPlan].wifiPrice > 0 ? 
                      <span className="text-red-600 font-bold text-sm">+{internetPlans[internetPlan].wifiPrice.toLocaleString()}원/월</span> : 
                      <span className="text-green-600 font-bold text-sm">무료 포함</span>
                    }
                  </div>
                </div>
              </div>
            )}

            {selectedProducts.tv && (
              <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
                <div className="bg-gray-100 p-3 flex items-center gap-2">
                  <Tv className="w-5 h-5 text-red-600" />
                  <span className="font-bold text-gray-800 text-sm">TV 상품 선택</span>
                </div>
                <div className="p-3">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3">
                    {Object.entries(tvPlans).map(([key, plan]) => (
                      <label key={key} className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: tvPlan === key ? '#dc2626' : '#e5e7eb', backgroundColor: tvPlan === key ? '#fef2f2' : 'white' }}>
                        <input type="radio" name="tv" value={key} checked={tvPlan === key} onChange={(e) => setTvPlan(e.target.value)} className="w-4 h-4 text-red-600" />
                        <span className="ml-2 flex-1">
                          <span className="block font-semibold text-gray-800 text-xs">{plan.name}</span>
                          <span className="block text-red-600 font-bold text-sm">{plan.internetCombined.toLocaleString()}원</span>
                        </span>
                      </label>
                    ))}
                  </div>
                  {tvPlan && (
                    <div className="border-t pt-3">
                      <p className="text-xs font-semibold text-gray-700 mb-2">셋탑박스 선택</p>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                        {Object.entries(settopBoxes).map(([key, box]) => (
                          <label key={key} className="flex items-center p-2 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: settopBox === key ? '#dc2626' : '#e5e7eb', backgroundColor: settopBox === key ? '#fef2f2' : 'white' }}>
                            <input type="radio" name="settop" value={key} checked={settopBox === key} onChange={(e) => setSettopBox(e.target.value)} className="w-3 h-3 text-red-600" />
                            <span className="ml-2 flex-1">
                              <span className="block font-medium text-gray-800 text-xs">{box.name}</span>
                              <span className="block text-red-600 font-bold text-xs">{box.price.toLocaleString()}원</span>
                            </span>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {selectedProducts.phone && (
              <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
                <div className="bg-gray-100 p-3 flex items-center gap-2">
                  <Phone className="w-5 h-5 text-red-600" />
                  <span className="font-bold text-gray-800 text-sm">전화 상품 선택</span>
                </div>
                <div className="p-3 grid grid-cols-1 md:grid-cols-2 gap-2">
                  {Object.entries(phonePlans).map(([key, plan]) => {
                    const hasTV = selectedProducts.tv && tvPlan;
                    const price = hasTV ? plan.withInternetTV : plan.withInternet;
                    return (
                      <label key={key} className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: phonePlan === key ? '#dc2626' : '#e5e7eb', backgroundColor: phonePlan === key ? '#fef2f2' : 'white' }}>
                        <input type="radio" name="phone" value={key} checked={phonePlan === key} onChange={(e) => setPhonePlan(e.target.value)} className="w-4 h-4 text-red-600" />
                        <span className="ml-2 flex-1">
                          <span className="block font-semibold text-gray-800 text-xs">{plan.name}</span>
                          <span className="block text-red-600 font-bold text-sm">{price.toLocaleString()}원</span>
                        </span>
                      </label>
                    );
                  })}
                </div>
              </div>
            )}

            {selectedProducts.cctv && (
              <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
                <div className="bg-gray-100 p-3 flex items-center gap-2">
                  <Camera className="w-5 h-5 text-red-600" />
                  <span className="font-bold text-gray-800 text-sm">기가아이즈 (CCTV)</span>
                </div>
                <div className="p-3">
                  <p className="text-xs text-gray-500 mb-2">※ 인터넷 결합 필수 상품입니다</p>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                    {Object.entries(cctvPlans).map(([key, plan]) => (
                      <label key={key} className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: cctvCount === key ? '#dc2626' : '#e5e7eb', backgroundColor: cctvCount === key ? '#fef2f2' : 'white' }}>
                        <input type="radio" name="cctv" value={key} checked={cctvCount === key} onChange={(e) => setCctvCount(e.target.value)} className="w-4 h-4 text-red-600" />
                        <span className="ml-2 flex-1">
                          <span className="block font-semibold text-gray-800 text-xs">{plan.name}</span>
                          <span className="block text-red-600 font-bold text-sm">{plan.price.toLocaleString()}원</span>
                        </span>
                      </label>
                    ))}
                  </div>
                </div>
              </div>
            )}

            <div className="mb-4 border-2 border-gray-200 rounded-xl overflow-hidden">
              <div className="bg-gray-100 p-3 flex items-center gap-2">
                <Wrench className="w-5 h-5 text-red-600" />
                <span className="font-bold text-gray-800 text-sm">설치 시기 선택</span>
              </div>
              <div className="p-3 grid grid-cols-2 gap-2">
                <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: installationType === 'weekday' ? '#dc2626' : '#e5e7eb', backgroundColor: installationType === 'weekday' ? '#fef2f2' : 'white' }}>
                  <input type="radio" name="installation" value="weekday" checked={installationType === 'weekday'} onChange={(e) => setInstallationType(e.target.value)} className="w-4 h-4 text-red-600" />
                  <span className="ml-2">
                    <span className="block font-semibold text-gray-800 text-sm">평일 설치</span>
                    <span className="block text-gray-600 text-xs">09:00 ~ 18:00</span>
                  </span>
                </label>
                <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md" style={{ borderColor: installationType === 'weekend' ? '#dc2626' : '#e5e7eb', backgroundColor: installationType === 'weekend' ? '#fef2f2' : 'white' }}>
                  <input type="radio" name="installation" value="weekend" checked={installationType === 'weekend'} onChange={(e) => setInstallationType(e.target.value)} className="w-4 h-4 text-red-600" />
                  <span className="ml-2">
                    <span className="block font-semibold text-gray-800 text-sm">주말/야간</span>
                    <span className="block text-gray-600 text-xs">주말 및 18:00 이후</span>
                  </span>
                </label>
              </div>
            </div>

            <div className="flex gap-3 mb-6">
              <button onClick={calculatePrice} disabled={!internetPlan} className="flex-1 bg-gradient-to-r from-red-600 to-red-500 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-red-700 hover:to-red-600 transition-all shadow-lg disabled:from-gray-300 disabled:to-gray-300 disabled:cursor-not-allowed">
                요금 계산하기
              </button>
              <button onClick={resetCalculator} className="px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-lg">
                초기화
              </button>
            </div>

            {showResult && (
              <div className="space-y-4">
                <div className="bg-gradient-to-br from-red-500 via-red-600 to-orange-500 rounded-2xl p-6 text-white shadow-2xl">
                  <div className="text-center">
                    <p className="text-lg mb-2 font-medium">월 이용 요금</p>
                    <p className="text-5xl font-bold mb-4">{totalPrice.toLocaleString()}<span className="text-3xl">원</span></p>
                    <div className="bg-white/15 backdrop-blur-sm rounded-xl p-4">
                      <p className="text-xs font-semibold mb-2 text-white/90">상품별 요금</p>
                      <div className="space-y-1 text-xs">
                        {breakdown.internet > 0 && <div className="flex justify-between"><span className="text-white/80">{internetPlans[internetPlan].name}{selectedProducts.wifi ? ' + 와이파이' : ''}</span><span className="font-semibold">{breakdown.internet.toLocaleString()}원</span></div>}
                        {breakdown.tv > 0 && <div className="flex justify-between"><span className="text-white/80">{tvPlans[tvPlan].name}</span><span className="font-semibold">{breakdown.tv.toLocaleString()}원</span></div>}
                        {breakdown.settop > 0 && <div className="flex justify-between"><span className="text-white/80">{settopBoxes[settopBox].name}</span><span className="font-semibold">{breakdown.settop.toLocaleString()}원</span></div>}
                        {breakdown.phone > 0 && <div className="flex justify-between"><span className="text-white/80">{phonePlans[phonePlan].name}</span><span className="font-semibold">{breakdown.phone.toLocaleString()}원</span></div>}
                        {breakdown.cctv > 0 && <div className="flex justify-between"><span className="text-white/80">{cctvPlans[cctvCount].name}</span><span className="font-semibold">{breakdown.cctv.toLocaleString()}원</span></div>}
                        {breakdown.uratDiscount < 0 && <div className="flex justify-between text-green-300"><span>으랏차차 할인</span><span className="font-semibold">{breakdown.uratDiscount.toLocaleString()}원</span></div>}
                        {breakdown.hiorderDiscount < 0 && <div className="flex justify-between text-green-300"><span>하이오더 할인</span><span className="font-semibold">{breakdown.hiorderDiscount.toLocaleString()}원</span></div>}
                        <div className="border-t border-white/30 pt-1 mt-2"><div className="flex justify-between font-bold"><span>합계</span><span>{totalPrice.toLocaleString()}원</span></div></div>
                      </div>
                      <p className="text-xs text-white/70 mt-3 text-center">※ 모든 금액은 부가세(VAT) 포함</p>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-xl">
                  <div className="text-center">
                    <p className="text-lg mb-2 font-medium">설치비 (1회)</p>
                    <p className="text-4xl font-bold mb-4">{installationFee.toLocaleString()}<span className="text-2xl">원</span></p>
                    <div className="bg-white/15 backdrop-blur-sm rounded-xl p-4">
                      <p className="text-xs font-semibold mb-2 text-white/90">설치비 상세</p>
                      <div className="space-y-1 text-xs">
                        {Object.entries(installationBreakdown).map(([key, item]) => (
                          <div key={key} className="flex justify-between">
                            <span className="text-white/80">{item.name}{item.note && ` (${item.note})`}</span>
                            <span className="font-semibold">{item.price === 0 ? '면제' : `${item.price.toLocaleString()}원`}</span>
                          </div>
                        ))}
                        <div className="border-t border-white/30 pt-1 mt-2"><div className="flex justify-between font-bold"><span>합계</span><span>{installationFee.toLocaleString()}원</span></div></div>
                      </div>
                      <p className="text-xs text-white/70 mt-3 text-center">※ {installationType === 'weekday' ? '평일' : '주말/야간'} 설치 기준</p>
                    </div>
                  </div>
                </div>
              </div>
            )}

            <div className="mt-6 text-center text-xs text-gray-500 bg-gray-50 rounded-lg p-3">
              <p className="font-medium">※ 상기 요금은 3년 약정 기준이며, 부가세(VAT) 포함 금액입니다.</p>
              <p className="mt-1">※ TV 및 전화는 인터넷 결합 시 할인이 적용된 금액입니다.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
